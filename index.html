<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Grammar Coach</title>
    <style>
        :root { --primary: #007bff; --bg: #f8f9fa; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
        .hidden { display: none; }
        
        /* Menu Styling */
        .menu-btn { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; background: white; cursor: pointer; text-align: left; font-size: 1.1rem; }
        .menu-btn:hover { background: #f0f7ff; border-color: var(--primary); }

        /* Explanation Styling */
        .explanation-box { line-height: 1.6; color: #444; }
        table { margin: 15px 0; font-size: 0.9rem; }
        
        /* Exercise Styling */
        .sentence { font-size: 1.5rem; margin: 20px 0; font-weight: bold; }
        input { font-size: 1.5rem; width: 70px; padding: 8px; text-align: center; border: 2px solid #ccc; border-radius: 5px; }
        .correct { border-color: green; background: #eaffea; }
        .wrong { border-color: red; background: #ffeaea; }
        button.main-btn { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <div id="screen-menu">
        <h2>Choose a Topic</h2>
        <div id="module-list"></div>
    </div>

    <div id="screen-explanation" class="hidden">
        <h2 id="exp-title"></h2>
        <div id="exp-content" class="explanation-box"></div>
        <button class="main-btn" onclick="startExercise()">I'm Ready!</button>
    </div>

    <div id="screen-exercise" class="hidden">
        <small id="ex-context" style="color: #888"></small>
        <div class="sentence" id="sentence-display"></div>
        <input type="text" id="answer-input" autocomplete="off" autocapitalize="off">
        <div id="feedback" style="margin-top: 10px; font-weight: bold;"></div>
        <button class="main-btn" id="action-btn" onclick="handleAction()">Check</button>
    </div>
</div>

<script src="exercises.js"></script>
<script>
    let currentModule = null;
    let currentQIdx = 0;
    let isChecking = true;

    function initMenu() {
        const list = document.getElementById('module-list');
        exerciseModules.forEach((mod, index) => {
            const btn = document.createElement('button');
            btn.className = 'menu-btn';
            btn.innerHTML = `<b>${index + 1}.</b> ${mod.title}`;
            btn.onclick = () => showExplanation(index);
            list.appendChild(btn);
        });
    }

    function showExplanation(index) {
        currentModule = exerciseModules[index];
        document.getElementById('screen-menu').classList.add('hidden');
        document.getElementById('screen-explanation').classList.remove('hidden');
        document.getElementById('exp-title').innerText = currentModule.title;
        document.getElementById('exp-content').innerHTML = currentModule.explanation;
    }

    function startExercise() {
        document.getElementById('screen-explanation').classList.add('hidden');
        document.getElementById('screen-exercise').classList.remove('hidden');
        currentQIdx = 0;
        loadQuestion();
    }

    function loadQuestion() {
        const q = currentModule.questions[currentQIdx];
        document.getElementById('sentence-display').innerText = q.sentence;
        document.getElementById('ex-context').innerText = q.context;
        const input = document.getElementById('answer-input');
        input.value = "";
        input.className = "";
        input.disabled = false;
        input.focus();
        document.getElementById('feedback').innerText = "";
        document.getElementById('action-btn').innerText = "Check";
        isChecking = true;
    }

    function handleAction() {
        if (isChecking) {
            const userAnsw = document.getElementById('answer-input').value.toLowerCase().trim();
            const correctAnsw = currentModule.questions[currentQIdx].ending;
            const input = document.getElementById('answer-input');
            
            if (userAnsw === correctAnsw) {
                input.className = "correct";
                document.getElementById('feedback').innerText = "✓ Richtig!";
                document.getElementById('feedback').style.color = "green";
            } else {
                input.className = "wrong";
                document.getElementById('feedback').innerText = `✗ Falsch! Correct: -${correctAnsw}`;
                document.getElementById('feedback').style.color = "red";
            }
            input.disabled = true;
            document.getElementById('action-btn').innerText = "Next";
            isChecking = false;
        } else {
            currentQIdx++;
            if (currentQIdx < currentModule.questions.length) {
                loadQuestion();
            } else {
                alert("Module Complete!");
                location.reload(); // Go back to menu
            }
        }
    }

    window.onload = initMenu;
</script>
</body>
</html>

